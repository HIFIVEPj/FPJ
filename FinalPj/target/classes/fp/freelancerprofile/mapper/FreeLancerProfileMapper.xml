<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="fp.freelancerprofile.mapper.FreeLancerProfileMapper">

	   <resultMap type="FreeLancer" id="FreeLancerResult">
	 
			<id column="free_code" property="free_code"/>
			<result column="mem_email" property="mem_email"/>
			<result column="free_name" property="free_name"/>
			<result column="free_tel" property="free_tel"/>
			<result column="free_point" property="free_point"/>
			<result column="free_rdate" property="free_rdate"/>
			<result column="free_level" property="free_level"/>
			<result column="free_acctox" property="free_acctox"/>
			<result column="free_fname" property="free_fname"/>
			<result column="free_ofname" property="free_ofname"/>
			
		<association  property="type" javaType="Type" >
		<id property="type_num" column="type_num"/>
		  <result property="type_name" column="type_name"/>
		</association>	
		

		<collection property="freelancerprofile" javaType="java.util.ArrayList" ofType="FreeLancerProfile">	
			<id property="free_code" column="free_code"/>
		  <result property="pro_num" column="pro_num"/>
		  <result property="type_num" column="type_num"/>
		  <result property="pro_exp" column="pro_exp"/>
		  <result property="pro_cv" column="pro_cv"/>
		  <result property="pro_addr" column="pro_addr"/>
		  <result property="pro_edu" column="pro_edu"/>
		  <result property="pro_start" column="pro_start"/>
		  <result property="pro_ox" column="pro_ox"/>
		  <result property="pro_grade" column="pro_grade"/>
		  <result property="profile_vcnt" column="profile_vcnt"/>
		  <result property="profile_pcnt" column="profile_pcnt"/>
		  <result property="pro_workplace" column="pro_workplace"/>
		 <result property="profile_sub" column="profile_sub"/>
		  <result property="profile_date" column="profile_date"/>
		</collection>	 	
		
		<collection property="freeLancerProfileFile" javaType="java.util.ArrayList" ofType="FreeLancerProfilefile" >
		<id property="free_code" column="free_code"/>
		  <id property="profile_num" column="profile_num"/>
		  <result property="pro_num" column="pro_num"/>
		  <result property="profile_fname" column="profile_fname"/>
		  <result property="profile_ofname" column="profile_ofname"/>
		  <result property="profile_size" column="profile_size"/>
		  <result property="profile_ext" column="profile_ext"/>
		</collection>	
		


		<collection property="keyword" javaType="java.util.ArrayList" ofType="KeyWord" >
		<id property="key_num" column="key_num"/>
		  <result property="key_name" column="key_name"/>
		</collection>	
		</resultMap>
		
		<!-- 오류원인 -->
		  <resultMap type="type" id="find_pro_sub">
		  	<id property="type_num" column="type_num"/>
			<result property="type_name" column="type_name"/>
			
			<collection property="freelancerprofile" javaType="java.util.ArrayList" ofType="freelancerprofile" > 
			   <id property="free_code" column="free_code"/>
			  <result property="pro_num" column="pro_num"/>
			  <result property="type_num" column="type_num"/>
			  <result property="pro_exp" column="pro_exp"/>
			  <result property="pro_cv" column="pro_cv"/>
			  <result property="pro_addr" column="pro_addr"/>
			  <result property="pro_edu" column="pro_edu"/>
			  <result property="pro_start" column="pro_start"/>
			  <result property="pro_ox" column="pro_ox"/>
			  <result property="pro_grade" column="pro_grade"/>
			  <result property="profile_vcnt" column="profile_vcnt"/>
			  <result property="profile_pcnt" column="profile_pcnt"/>
			  <result property="pro_workplace" column="pro_workplace"/>
			 <result property="profile_sub" column="profile_sub"/>
			  <result property="profile_date" column="profile_date"/>
		  	</collection>		
			
		  	<collection property="project" javaType="java.util.ArrayList" ofType="Project" >
			<id property="pj_num" column="pj_num"/>
			  <result property="type_num" column="type_num"/>
			  <result property="cate_num" column="cate_num"/>
			  <result property="cor_code" column="cor_code"/>
			   <result property="pj_sub" column="pj_sub"/>
			  <result property="pj_ddate" column="pj_ddate"/>
			  <result property="pj_place" column="pj_place"/>
			  <result property="pj_name" column="pj_name"/>	
			</collection>	

	   </resultMap>
	
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 	<!-- 프리랜서 프로필 리스트 select -->
   <select id="selectProfileList"  resultMap="FreeLancerResult">
      <![CDATA[
		select *
			from FREELANCER f
				inner join FREELANCER_PROFILE fp
				on f.FREE_CODE = fp.FREE_CODE 
					inner join FREELANCER_PROFILEFILE ffile
					on f.FREE_CODE = ffile.FREE_CODE 
      ]]>
   </select>
   
     <!-- 프리랜서 프로필 컨텐츠 1-->
     <select id="selectProfileContent"  parameterType="long" resultMap="FreeLancerResult">

      <![CDATA[
		select fp.PRO_NUM, FREE_NAME, PRO_WORKPLACE, MEM_EMAIL, FREE_TEL,
		PRO_CV, PROFILE_DATE, PROFILE_OFNAME 
			from FREELANCER f 
				inner join FREELANCER_PROFILE fp
				on f.FREE_CODE = fp.FREE_CODE
					inner join FREELANCER_PROFILEFILE ffile
					on f.FREE_CODE = ffile.FREE_CODE
					where fp.PRO_NUM=#{PRO_NUM}
      ]]>
   </select>
   <!-- 프리랜서 프로필 컨텐츠 2-->
        <select id="selectProfileContent2"  parameterType="long" resultMap="find_pro_sub">

      <![CDATA[
		select p.PJ_SUB, t.TYPE_NAME, fp.PRO_NUM
			from Type t
				full outer join FREELANCER_PROFILE fp
				on t.TYPE_NUM = fp.TYPE_NUM 
					full outer join PROJECT p
					on t.TYPE_NUM = p.TYPE_NUM
					where fp.PRO_NUM=#{PRO_NUM}
      ]]>
   </select>
    <!-- 프리랜서 프로필 컨텐츠 3-->
          <select id="selectProfileContent3"  parameterType="long" resultMap="FreeLancerResult">

      <![CDATA[
		select k.KEY_NAME from FREE_PICK_KEYWORD fk
			full outer join FREELANCER_PROFILE fp
			on fk.PRO_NUM = fp.PRO_NUM 
				full outer join KEYWORD k
				on fk.KEY_NUM = k.KEY_NUM
				where fp.PRO_NUM=#{PRO_NUM}
      ]]>
   </select>
   

   <delete id="listDelete" parameterType="long">
   <![CDATA[
	   	delete from FREELANCER_PROFILEFILE
			where FREE_CODE in (select FREE_CODE  from FREELANCER_PROFILE where FREE_CODE in 
					(select FREE_CODE from FREELANCER where FREELANCER.FREE_CODE=FREELANCER_PROFILEFILE.FREE_CODE)
				and FREELANCER_PROFILE.FREE_CODE=FREELANCER_PROFILE.FREE_CODE) and PRO_NUM=#{PRO_NUM}
   ]]>
	</delete>

 
</mapper>
