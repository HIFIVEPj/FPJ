<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="fp.freelancerlist.mapper.FreeLancerlistMapper">

	   <resultMap type="List_FreeLancer" id="List_FreeLancerResult">
		  	<id column="free_code" property="free_code"/>
		    <result column="mem_email" property="mem_email"/>		
			<result column="free_name" property="free_name"/>

		<association  property="list_type" javaType="List_type" >
			  <id property="type_num" column="type_num"/>
			  <result property="type_name" column="type_name"/>
		</association>	 
		<collection property="list_freelancerprofile" javaType="java.util.ArrayList" ofType="list_freelancerprofile">	
				<id property="free_code" column="free_code"/>
				<result property="pro_num" column="pro_num"/>
				<result property="type_num" column="type_num"/>
				<result column="mem_email" property="mem_email"/>	
				<result property="pro_exp" column="pro_exp"/>
				<result property="pro_vcnt" column="pro_vcnt"/>
		</collection>	 
	  	<collection property="list_project" javaType="java.util.ArrayList" ofType="List_Project" >
			<id property="pj_num" column="pj_num"/>
			  <result property="type_num" column="type_num"/>
			  <result property="cate_num" column="cate_num"/>
			  <result property="cor_code" column="cor_code"/>
			  <result property="pj_sub" column="pj_sub"/>
			  <result property="pj_ddate" column="pj_ddate"/>
			  <result property="pj_place" column="pj_place"/>
			  <result property="pj_name" column="pj_name"/>	
		</collection>	
		<collection property="list_review" javaType="java.util.ArrayList" ofType="List_FreeLancerReview">	
				<id property="free_code" column="free_code"/>
				 <result property="pro_num" column="pro_num"/>
		 		 <result property="mem_email" column="mem_email"/>	
				 <result property="freerev_star" column="freerev_star"/>
		</collection>
	</resultMap>
		
		<!-- 리스트페이지 프로젝트, 타입 select -->
		<resultMap type="list_freelancerprofile" id="TypeNpjSub">
			<id property="free_code" column="free_code"/>
				<result property="pro_num" column="pro_num"/>
				<result property="type_num" column="type_num"/>
				<result column="mem_email" property="mem_email"/>	
				<result property="pro_exp" column="pro_exp"/>
				<result property="pro_vcnt" column="pro_vcnt"/>
			<association  property="list_type" javaType="List_type" >
			  	<id property="type_num" column="type_num"/>
			 	<result property="type_name" column="type_name"/>
			</association>	 
		  		<collection property="list_project" javaType="java.util.ArrayList" ofType="List_Project" >
				<id property="pj_num" column="pj_num"/>
				  <result property="type_num" column="type_num"/>
				  <result property="cate_num" column="cate_num"/>
				  <result property="cor_code" column="cor_code"/>
				  <result property="pj_sub" column="pj_sub"/>
				  <result property="pj_ddate" column="pj_ddate"/>
				  <result property="pj_place" column="pj_place"/>
				  <result property="pj_name" column="pj_name"/>	
				</collection>	
			</resultMap>

		<!-- 프로젝트 컨텐츠 1 -->
		   <resultMap type="Freelancer_FreeLancerProfile" id="freelancerContent">
				<id property="free_code" column="free_code"/>
				  <result property="pro_num" column="pro_num"/>
				  <result property="type_num" column="type_num"/>
				  <result column="mem_email" property="mem_email"/>	
				  <result property="pro_exp" column="pro_exp"/>
				  <result property="pro_addr" column="pro_addr"/>
				  <result property="pro_vcnt" column="pro_vcnt"/>
				  <result property="pro_edu" column="pro_edu"/>
				  <result property="pro_start" column="pro_start"/>
			 	  <result property="pro_ox" column="pro_ox"/>
				  <result property="pro_place" column="pro_place"/>
				  <result property="pro_workplace" column="pro_workplace"/>
	
			  	<collection property="freelancer" javaType="java.util.ArrayList" ofType="freelancer">
					<id property="free_code" column="free_code"/>
					  <result property="free_name" column="free_name"/>
					  <result property="mem_email" column="mem_email"/>
					  <result property="free_tel" column="free_tel"/>
				</collection>	
				<collection property="freelancerprofilefile" javaType="java.util.ArrayList" ofType="freelancerprofilefile" >
			        <id property="free_code" column="free_code"/>
			        <id property="profile_num" column="profile_num"/>
			        <result property="pro_num" column="pro_num"/>
			        <result property="profile_fname" column="profile_fname"/>
			        <result property="profile_ofname" column="profile_ofname"/>
			        <result property="profile_size" column="profile_size"/>
			        <result property="profile_ext" column="profile_ext"/>
		        </collection>   
				<collection property="list_freeLancerReview" javaType="java.util.ArrayList" ofType="List_FreeLancerReview">	
				<id property="free_code" column="free_code"/>
				    <result property="pro_num" column="pro_num"/>
		 		    <result column="mem_email" property="mem_email"/>	
				      <result property="freerev_star" column="freerev_star"/>
				</collection>
			</resultMap>
			
				<!-- 프로젝트 컨텐츠 2 -->
			<resultMap type="Freelancer_FreeLancerProfile" id="freelancerContent2">
					<id property="free_code" column="free_code"/>
					<result property="pro_num" column="pro_num"/>
					<result property="type_num" column="type_num"/>
				 	 
			  	<collection property="frProject" javaType="java.util.ArrayList" ofType="frProject" >
					<id property="pj_num" column="pj_num"/>
					<result property="type_num" column="type_num"/>
					<result property="cate_num" column="cate_num"/>
					<result property="cor_code" column="cor_code"/>
					<result property="pj_sub" column="pj_sub"/>
					<result property="pj_ddate" column="pj_ddate"/>
					<result property="pj_place" column="pj_place"/>
					<result property="pj_name" column="pj_name"/>	
				</collection>	
				<collection property="Applied_Project" javaType="java.util.ArrayList" ofType="Applied_Project" >
					<result property="free_code" column="free_code"/>
					<result property="pro_num" column="pro_num"/>
					<result property="pj_num" column="pj_num"/>
					<result property="appp_status" column="appp_status"/>
				</collection>	
			</resultMap>
						
		<!-- 프로젝트 컨텐츠 3 -->
			<resultMap type="Freelancer_FreeLancerProfile" id="freelancerContent3">
					<id property="free_code" column="free_code"/>
					<result property="pro_num" column="pro_num"/>
					<result property="type_num" column="type_num"/>
					
				<collection property="FreePick" javaType="java.util.ArrayList" ofType="FreePick" >
					<id property="free_keynum" column="free_keynum"/>
					<result property="key_num" column="key_num"/>
					<result property="free_code" column="free_code"/>
				    <result property="pro_num" column="pro_num"/>
				</collection>					  
				<collection property="frKeyWord" javaType="java.util.ArrayList" ofType="frKeyWord" >
					<id property="key_num" column="key_num"/>
					<result property="key_name" column="key_name"/>
				</collection>	
			</resultMap>
				
		<!-- 프로젝트 컨텐츠 4-->
			<resultMap type="frType" id="freelancerContent4">
			    	<id property="type_num" column="type_num"/>
				    <result property="type_name" column="type_name"/>
		
				<collection property="Freelancer_FreeLancerProfile" javaType="java.util.ArrayList" ofType="Freelancer_FreeLancerProfile">
					<id property="free_code" column="free_code"/>
					<result property="pro_num" column="pro_num"/>
					<result property="type_num" column="type_num"/>
				</collection>
			</resultMap>

	<!-- 프로젝트 컨텐츠 5-->
			<resultMap type="frProject" id="freelancerContent5">
			    	<id property="pj_num" column="pj_num"/>
					<result property="type_num" column="type_num"/>
					<result property="cate_num" column="cate_num"/>
		
				<collection property="Pj_Pick_Keyword" javaType="java.util.ArrayList" ofType="Pj_Pick_Keyword">
					<id property="pjp_keynum" column="pjp_keynum"/>
					<result property="key_num " column="key_num"/>
					<result property="pj_num" column="pj_num"/>
				</collection>
				<collection property="frKeyWord" javaType="java.util.ArrayList" ofType="frKeyWord" >
					<id property="key_num" column="fr_key_num"/>
					<result property="key_name" column="key_name"/>
				</collection>	
			</resultMap>
				
			<!-- 프로젝트 제목 select -->
			<resultMap type="frProject" id="subSelect">
					<id property="pj_num" column="pj_num"/>
					<result property="type_num" column="type_num"/>
					<result property="cate_num" column="cate_num"/>
					<result property="cor_code" column="cor_code"/>
					<result property="pj_sub" column="pj_sub"/>
					<result property="pj_ddate" column="pj_ddate"/>
					<result property="pj_place" column="pj_place"/>
					<result property="pj_name" column="pj_name"/>	
				<collection property="Applied_Project" javaType="java.util.ArrayList" ofType="Applied_Project" >
				 	<id property="pj_num" column="pj_num"/>
				  	<result property="free_code" column="free_code"/>
					<result property="pro_num" column="pro_num"/> 
					<result property="appp_status" column="appp_status"/> 	
				</collection>	
			</resultMap>
			
		<!-- 프로필 리뷰 content-->
			<resultMap type="List_FreeLancerReview" id="freelancerReview">
					<id property="freerev_num" column="freerev_num"/>
					<result property="freerev_cont" column="freerev_cont"/>
					<result property="freerev_star" column="freerev_star"/>
					<result property="freerev_rdate" column="freerev_rdate"/>
					<result property="pro_num" column="pro_num"/>
					<result property="free_code" column="free_code"/>
			 		<result property="mem_email" column="mem_email"/>			
				<collection property="mMember" javaType="java.util.ArrayList" ofType="mMember" >
				 	<id property="mem_email" column="mem_email"/>
				  	<result property="mem_name" column="mem_name"/>
				  	<result property="class_num" column="class_num"/>
				  	<result property="mem_status" column="mem_status"/>		  	
				</collection>
				<collection property="FreeLancerProfile" javaType="java.util.ArrayList" ofType="FreeLancerProfile" >
				 	<id property="pro_num" column="pro_num"/>	  	
				</collection>			
			</resultMap>
					
			
			
			
			
			
			
			

	<!-- 리스트 select -->
   		<!-- 리스트 페이징 (총 게시글 갯수 출력 ) -->
    <select id="countFreeLancer" resultType="int">
   		select count(*) from FreeLancer_Profile
    </select>
	<select id="SelectList" resultMap="List_FreeLancerResult" parameterType="List_PagingVO">
	    <![CDATA[
		select f.rnum, f.FREE_NAME 
			    , f.PRO_NUM
			    , f.free_code
			    , f.PRO_EXP 
			    , f.PRO_VCNT 
			    , f.FREEREV_STAR from
					(select rownum rnum, free.FREE_NAME 
							  , free.PRO_NUM
							  , free.free_code
							  , free.PRO_EXP 
							  , free.PRO_VCNT
							  , free.FREEREV_STAR from
						(select FREE_NAME , f.free_code
							 			  , fp.PRO_NUM
      									  , PRO_EXP 
    									  , PRO_VCNT
    							 		  , FREEREV_STAR 
								from FREELANCER f 
								inner join FREELANCER_PROFILE fp
									on f.FREE_CODE = fp.FREE_CODE
									inner join FREELANCER_REVIEW fr
										on f.FREE_CODE= fr.FREE_CODE) free
										where rownum <= #{end}) f
											 where f.rnum>= #{start}
		]]>
	</select>
	
		<!-- 리스트페이지 프로젝트, 타입 select -->
	<select id="SelectList2" resultMap="TypeNpjSub" parameterType="long">
	    <![CDATA[
		select fp.FREE_CODE
				, t.TYPE_NUM
				, t.TYPE_NAME
				, ap.PJ_NUM
				, p.PJ_SUB
					from FREELANCER_PROFILE fp
					left outer join TYPE t 
						on fp.TYPE_NUM=t.TYPE_NUM
					left outer join APPLIED_PROJECT ap
						on fp.FREE_CODE=ap.FREE_CODE
					left outer join  PROJECT p
						on ap.PJ_NUM=p.PJ_NUM
									
		]]>						
	</select> 
	
		<!-- 리스트페이지 프로젝트 select -->
	<select id="SelectList3" resultMap="subSelect" >
	    <![CDATA[
		select ap.pj_num
				,appp_status
				,pj_sub
				  from APPLIED_PROJECT ap 
				  	inner join PROJECT p
					on ap.pj_num=p.pj_num
						where appp_status=1
		]]>						
	</select> 

	<!-- 컨텐츠 -->
	<select id="freelancercontent" resultMap="freelancerContent" parameterType="long">
	  <![CDATA[
		select distinct fp.free_code 
						, free_name
						, free_tel
						, fp.mem_email
						, pro_exp 
						, pro_addr
						, pro_workplace
						, pro_vcnt
						, pro_edu 
						, pro_start 
						, pro_ox 
						, pro_place 
						, freerev_star
						, profile_ofname
						from freelancer f, freelancer_profile fp
							,freelancer_profilefile ff, FREELANCER_REVIEW fr
							where fp.free_code=f.free_code
							and fp.free_code = ff.free_code
							and fp.free_code = fr.free_code
								AND fp.free_code=#{free_code}				
			]]>		
	</select> 
		<!-- 컨텐츠 2-->
	<select id="freelancercontent2" resultMap="freelancerContent2" parameterType="long">
	  <![CDATA[
			select fp.free_code 
				, ap.pj_num
				, pj_sub
				from freelancer_profile fp
					inner join 
					APPLIED_PROJECT ap
					on  fp.free_code=ap.free_code
						inner join
						Project p
						on ap.pj_num= p.pj_num
							where fp.free_code=#{FREE_CODE}
			]]>		
	</select> 
		<!-- 컨텐츠 3-->
	<select id="freelancercontent3" resultMap="freelancerContent3" parameterType="long">
	  <![CDATA[
			select fp.free_code
					, fpk.KEY_NUM
					, KEY_NAME
						from FREELANCER_PROFILE fp
							left outer join FREE_PICK_KEYWORD fpk
							on fp.FREE_CODE=fpk.FREE_CODE
								left outer join KEYWORD k
								on fpk.KEY_NUM= k.KEY_NUM
									where fp.free_code=#{FREE_CODE}	
			]]>		
	</select> 
		<!-- 컨텐츠 4-->
	<select id="freelancercontent4" resultMap="freelancerContent4" parameterType="long">
	  <![CDATA[
			select fp.FREE_CODE
					, t.Type_num
					, TYPE_NAME
						from FREELANCER_PROFILE fp
							left outer join TYPE t
							on t.TYPE_NUM=fp.TYPE_NUM
							where FREE_CODE=#{FREE_CODE}
							
			]]>		
	</select> 
		<!-- 컨텐츠 5-->
	<select id="freelancercontent5" resultMap="freelancerContent5" parameterType="long">
	  <![CDATA[
			select COR_CODE
					, p.PJ_NUM
					, PJP_KEYNUM
					, k.KEY_NUM as fr_key_num
					, KEY_NAME
						from PROJECT p
						left outer join PJ_PICK_KEYWORD pk
							on p.PJ_NUM= pk.PJ_NUM
						left outer join KEYWORD k
							on pk.KEY_NUM=k.KEY_NUM
								where pk.PJ_NUM=#{PJ_NUM}			
	  ]]>		
	</select> 
	
	<!-- 프리랜서 리뷰(+페이징) -->
	<select id="countReview" resultType="int">
   		select count(*) from freelancer_review
    </select>
	<!-- <select id="freelancerReview" resultMap="freelancerReview" parameterType="map">
	  <![CDATA[
		select * from 
			(select ROWNUM rnum , aa.* from 
				(select  fr.*, m.mem_name from freelancer_review  fr
	                 inner join member m
	                  on fr.mem_email = m.mem_email
		           		where free_code=#{free_code})aa)
		                  where rnum>=#{start} and rnum<=#{end}
	  ]]>		
	</select>--> 
		<select id="freelancerReview" resultMap="freelancerReview" parameterType="map">
	  <![CDATA[
			select ROWNUM , fr.freerev_num
						  , fr.freerev_cont
                          ,fr.freerev_star
                          , fr.freerev_rdate
                          , fr.pro_num
                          , fr.free_code
                          , fr.mem_email
                          , m.mem_name
                          , fp.pro_num
                          , fr.pro_num 
                          from freelancer_review  fr
                             inner join member m
                             on fr.mem_email = m.mem_email
                                 inner join freelancer_profile fp
                                 on fr.pro_num = fp.pro_num
                                    where fr.free_code=#{free_code}
                                     and ROWNUM <= #{end}
                                     and ROWNUM>=#{start} 
                                     order by freerev_rdate desc
                                     	
	  ]]>	
	</select> 
	
	<!-- 리뷰 insert -->
 	<insert id="reviewInsert" parameterType="fp.freelancerprofile.domain.List_FreeLancerReview"> 
  	<selectKey keyProperty="freerev_num" order="BEFORE" resultType="long">
		select FREEREV_NUM_SEQ.NEXTVAL from dual
	 </selectKey> 
	<![CDATA[
		insert into freelancer_review (freerev_num, freerev_star, freerev_cont, freerev_rdate,pro_num, free_code, mem_email)
	values
		(#{freerev_num}, #{freerev_star}, #{freerev_cont}, sysdate, #{pro_num} , #{free_code}, #{mem_email})
		   ]]>
	</insert>
	<!-- 리뷰 update -->
 	<update id="reviewUpdate" parameterType="long"> 
 	  <selectKey keyProperty="freerev_num" order="BEFORE" resultType="fp.freelancerprofile.domain.List_FreeLancerReview">
		select FREEREV_NUM_SEQ.NEXTVAL from dual
	  </selectKey> 
	<![CDATA[
		update set freelancer_review freerev_num= #{freerev_num},freerev_star= #{freerev_star},freerev_cont= #{freerev_cont}
		   ]]>
	</update>  
	
	<!-- 리뷰 delete -->
 	<delete id="reviewDelete" parameterType="long"> 
	<![CDATA[
		delete from freelancer_review where freerev_num=#{freerev_num}
		   ]]>
	</delete> 
	
</mapper>
