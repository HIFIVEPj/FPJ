<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="fp.member.mapper.MemberMapper">
	
   	 <resultMap id="EMAIL_AUTHENTICATION" type="EmailAuth">
		<result property="email" column="MEM_EMAIL" />
		<result property="dice" column="EMAIL_AUTH" />
	</resultMap>
	
	 <resultMap id="MemberMap" type="Member">	 	
	 	<id property="email" column="MEM_EMAIL"/>		
		<result property="pwd" column="MEM_PWD"/>		
		<result property="class_num" column="CLASS_NUM"/>
		<result property="enabled" column="ENABLED"/>		
		<collection property="authList" resultMap="authMap">
		</collection>
	</resultMap>
	
	<resultMap id="authMap" type="MemberAuth" >
		<result property="email" column="MEM_EMAIL" />
		<result property="auth" column="MEM_AUTH" />		
	</resultMap>
	
	<select id="selectMemList" resultMap="MemberMap">
  		SELECT m.MEM_EMAIL, m.MEM_PWD, m.ENABLED, a.MEM_AUTH FROM MEMBER m LEFT OUTER JOIN MEMBER_AUTH a on m.MEM_EMAIL=a.MEM_EMAIL WHERE m.MEM_EMAIL= #{email} 
	</select>
	
	<select id="selectEmailAuth" resultType="EmailAuth" parameterType="String" resultMap="EMAIL_AUTHENTICATION">
		SELECT * FROM EMAIL_AUTHENTICATION WHERE MEM_EMAIL=#{email}
	</select>

	<insert id="insertMem" parameterType="Member">
		insert into MEMBER(MEM_EMAIL, MEM_PWD, CLASS_NUM) values(#{email}, #{pwd}, #{class_num})
	</insert>

	<insert id="insertAuth" parameterType="Map">
		insert into EMAIL_AUTHENTICATION(MEM_EMAIL,EMAIL_AUTH )values(#{email}, #{dice})
	</insert>	
	
	<!--  
	<delete id="delete" parameterType="long">
		delete from ADDRESS where SEQ=#{seq}
	</delete>
	-->
	
</mapper>