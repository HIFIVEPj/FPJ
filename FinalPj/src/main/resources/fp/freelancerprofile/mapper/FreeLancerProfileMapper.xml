<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="fp.freelancerprofile.mapper.FreeLancerProfileMapper">

      <resultMap type="Freelancer" id="FreeLancerResult">
    
         <id column="free_code" property="free_code"/>
         <result column="mem_email" property="mem_email"/>
         <result column="free_name" property="free_name"/>
         <result column="free_tel" property="free_tel"/>
         <result column="free_point" property="free_point"/>
         <result column="free_rdate" property="free_rdate"/>
         <result column="free_level" property="free_level"/>
         <result column="free_acctox" property="free_acctox"/>
         <result column="free_fname" property="free_fname"/>
         <result column="free_ofname" property="free_ofname"/>
         
      <association  property="type" javaType="frType">
      <id property="type_num" column="type_num"/>
        <result property="type_name" column="type_name"/>
      </association>   
      

      <collection property="freelancerprofile" javaType="java.util.ArrayList" ofType="FreelancerProfile">   
         <id property="free_code" column="free_code"/>
        <result property="pro_num" column="pro_num"/>
        <result property="type_num" column="type_num"/>
        <result property="pro_exp" column="pro_exp"/>
        <result property="pro_cv" column="pro_cv"/>
        <result property="pro_addr" column="pro_addr"/>
        <result property="pro_edu" column="pro_edu"/>
        <result property="pro_start" column="pro_start"/>
        <result property="pro_ox" column="pro_ox"/>
        <result property="pro_grade" column="pro_grade"/>
        <result property="profile_vcnt" column="profile_vcnt"/>
        <result property="profile_pcnt" column="profile_pcnt"/>
        <result property="pro_workplace" column="pro_workplace"/>
       <result property="profile_sub" column="profile_sub"/>
        <result property="profile_date" column="profile_date"/>
      </collection>       
      
      <collection property="freeLancerProfileFile" javaType="java.util.ArrayList" ofType="FreeLancerProfilefile" >
      <id property="free_code" column="free_code"/>
        <id property="profile_num" column="profile_num"/>
        <result property="pro_num" column="pro_num"/>
        <result property="profile_fname" column="profile_fname"/>
        <result property="profile_ofname" column="profile_ofname"/>
        <result property="profile_size" column="profile_size"/>
        <result property="profile_ext" column="profile_ext"/>
      </collection>   
      


      <collection property="keyword" javaType="java.util.ArrayList" ofType="frKeyWord" >
      <id property="key_num" column="key_num"/>
        <result property="key_name" column="key_name"/>
      </collection>   
      </resultMap>
      

        <resultMap type="frtype" id="find_pro_sub">
           <id property="type_num" column="type_num"/>
         <result property="type_name" column="type_name"/>
         
         <collection property="freelancerprofile" javaType="java.util.ArrayList" ofType="freelancerprofile" > 
            <id property="free_code" column="free_code"/>
           <result property="pro_num" column="pro_num"/>
           <result property="type_num" column="type_num"/>
           <result property="pro_exp" column="pro_exp"/>
           <result property="pro_cv" column="pro_cv"/>
           <result property="pro_addr" column="pro_addr"/>
           <result property="pro_edu" column="pro_edu"/>
           <result property="pro_start" column="pro_start"/>
           <result property="pro_ox" column="pro_ox"/>
           <result property="pro_grade" column="pro_grade"/>
           <result property="profile_vcnt" column="profile_vcnt"/>
           <result property="profile_pcnt" column="profile_pcnt"/>
           <result property="pro_workplace" column="pro_workplace"/>
          <result property="profile_sub" column="profile_sub"/>
           <result property="profile_date" column="profile_date"/>
           </collection>      
         
           <collection property="project" javaType="java.util.ArrayList" ofType="frProject" >
         <id property="pj_num" column="pj_num"/>
           <result property="type_num" column="type_num"/>
           <result property="cate_num" column="cate_num"/>
           <result property="cor_code" column="cor_code"/>
            <result property="pj_sub" column="pj_sub"/>
           <result property="pj_ddate" column="pj_ddate"/>
           <result property="pj_place" column="pj_place"/>
           <result property="pj_name" column="pj_name"/>   
         </collection>   

      </resultMap>
  
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 	<!-- 프리랜서 프로필 리스트 select -->
   <!--<select id="selectProfileList"  resultMap="FreeLancerResult">
 	     <![CDATA[
	select MEM_EMAIL, fp.PROFILE_SUB, fp.PROFILE_DATE, ffile.PROFILE_OFNAME
			from FREELANCER f
				inner join FREELANCER_PROFILE fp
				on f.FREE_CODE = fp.FREE_CODE 
					inner join FREELANCER_PROFILEFILE ffile
					on f.FREE_CODE = ffile.FREE_CODE
      ]]>
   </select>-->
   <!-- 리스트 페이징 (총 게시글 갯수 출력 ) -->
    <select id="countProfileList" resultType="int">
   		select count(*) from FreeLancer_Profile
    </select>
   <!-- 리스트 페이징 (페이징 처리 후 게시글 조회 ) -->
   <select id="selectPageList" parameterType="PagingVO" resultMap="FreeLancerResult">

   	<![CDATA[	
   		select f.rnum, f.MEM_EMAIL, 
   			   f.PROFILE_SUB, f.PROFILE_DATE, 
   			   f.PROFILE_OFNAME, f.PRO_NUM from
			(select rownum rnum, free.MEM_EMAIL, free.PROFILE_SUB, 
			        free.PROFILE_DATE, free.PROFILE_OFNAME, free.PRO_NUM from
				(select fp.MEM_EMAIL
					, fp.PROFILE_SUB
					, fp.PROFILE_DATE
					, ffile.PROFILE_OFNAME
					, fp.PRO_NUM 
					from FREELANCER_PROFILE fp
						inner join FREELANCER_PROFILEFILE ffile
							on fp.PRO_NUM = ffile.PRO_NUM ) free
								where rownum <=  #{end}) f
								 where f.rnum>= #{start}	
	 ]]>
   </select>
   
     <!-- 프리랜서 프로필 컨텐츠 1-->
     <select id="selectProfileContent"  parameterType="long" resultMap="FreeLancerResult">

      <![CDATA[
		select fp.PRO_NUM
		         , FREE_NAME
		         , PRO_WORKPLACE
		         , fp.MEM_EMAIL
		         , FREE_TEL
		         , PRO_CV
		         , PROFILE_DATE
		         , PROFILE_OFNAME 
			from FREELANCER_PROFILE fp
				inner join FREELANCER f 
					on fp.FREE_CODE = f.FREE_CODE
						inner join FREELANCER_PROFILEFILE ffile
						on f.FREE_CODE = ffile.FREE_CODE
						where fp.PRO_NUM=#{PRO_NUM}
      ]]>
   </select>
   <!-- 프리랜서 프로필 컨텐츠 2-->
        <select id="selectProfileContent2"  parameterType="long" resultMap="find_pro_sub">

      <![CDATA[
		select p.PJ_SUB
			   , t.TYPE_NAME
			   , fp.PRO_NUM
			from Type t
				full outer join FREELANCER_PROFILE fp
				on t.TYPE_NUM = fp.TYPE_NUM 
					full outer join PROJECT p
					on t.TYPE_NUM = p.TYPE_NUM
					where fp.PRO_NUM=#{PRO_NUM}
      ]]>
   </select>
    <!-- 프리랜서 프로필 컨텐츠 3-->
          <select id="selectProfileContent3"  parameterType="long" resultMap="FreeLancerResult">

      <![CDATA[
		select k.KEY_NAME from FREE_PICK_KEYWORD fk
			full outer join FREELANCER_PROFILE fp
			on fk.PRO_NUM = fp.PRO_NUM 
				full outer join KEYWORD k
				on fk.KEY_NUM = k.KEY_NUM
				where fp.PRO_NUM=#{PRO_NUM}
      ]]>
   </select>
   

	<!-- 삭제1 (프로필파일 데이터 삭제) -->
   <delete id="listDelete" parameterType="long">
	   <![CDATA[
		 	delete from FREELANCER_PROFILEFILE where PRO_NUM=#{PRO_NUM}
	   ]]>
	</delete>
	
	<!-- 삭제2 (프로필파일 데이터 삭제) -->
	<delete id="listDelete2" parameterType="long">
		<![CDATA[
		 	delete from FREELANCER_PROFILE where PRO_NUM=#{PRO_NUM}
	   ]]>
	</delete>
	
	
	<!-- 삭제1 (체크박스 데이터 삭제) -->
   <delete id="checkdelete1" parameterType="long">
	   <![CDATA[
		 	delete from FREELANCER_PROFILE  where PRO_NUM in(#{PRO_NUM})
	   ]]>
	</delete>

	
	<!-- 프로필 insert -->
 	<insert id="listInsert" parameterType="fp.freelancerprofile.domain.FreeLancerProfile"> 
  	<selectKey keyProperty="pro_num" order="BEFORE" resultType="long">
		select PRO_NUM_SEQ.NEXTVAL from dual
	 </selectKey>

	<![CDATA[
		insert into freelancer_profile (pro_num, free_code, type_num, mem_email, pro_exp, pro_cv, pro_addr, pro_postcode, pro_detailloc, pro_edu, pro_start, pro_ox, pro_grade, pro_place, pro_workplace, profile_sub, profile_date)
	values
		(#{pro_num}, #{free_code}, #{type_num}, #{mem_email} , #{pro_exp}, #{pro_cv}, #{pro_addr}, #{pro_postcode}, #{pro_detailloc},#{pro_edu}, #{pro_start}, #{pro_ox}, #{pro_grade}, #{pro_place}, #{pro_workplace}, #{profile_sub}, sysdate)
		   ]]>
	</insert> 

	<!-- 프로필 선택 키워드 insert -->
	 <insert id="insertPjpkeyword" parameterType="map">
		 <selectKey keyProperty="pro_num" order="BEFORE" resultType="long">
			 select PRO_NUM_SEQ.CURRVAL from dual
		 </selectKey>
		 
		 <if test="key_num != null">
		 	insert into FREE_PICK_KEYWORD(free_keynum, key_num, free_code, pro_num)
		 	select  free_keynum_seq.nextval, A.* from(
		  <foreach collection ="key_num" item="key_num" separator="UNION ALL "> 
			 select  #{key_num}, #{free_code}, #{pro_num} from dual
		 </foreach>) A
		 </if>
	 </insert>




</mapper>
